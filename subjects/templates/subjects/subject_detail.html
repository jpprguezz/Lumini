{% extends "base.html" %}
{% load i18n %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-start">
    <div>
      <h3>{{ subject.code }} - {{ subject.name }}</h3>
      <p>{% trans "Profesor" %}: {{ subject.teacher.get_full_name }}</p>
    </div>

    {% if enrollment %}
    <div class="text-end">
      <small class="text-muted d-block">{% trans "Your mark" %}</small>
      {% if enrollment.mark is not None %}
        <span class="badge bg-info fs-6">{{ enrollment.mark }}</span>
      {% else %}
        <span class="text-muted">{% trans "No mark" %}</span>
      {% endif %}
    </div>
    {% endif %}
  </div>

  {% if messages %}
    <div class="mt-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mt-2" role="alert">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  {% if lessons %}
    <ul class="list-group mt-3">
      {% for lesson in lessons %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <a href="{% url 'subjects:lesson_detail' subject.code lesson.pk %}">{{ lesson.title }}</a>
          <small class="text-muted ms-3">{{ lesson.content|truncatechars:80 }}</small>
        </div>

        {% if request.user.profile.role == 'T' and subject.teacher == request.user %}
        <div class="btn-group">
          <a href="{% url 'subjects:edit_lesson' subject.code lesson.pk %}" class="btn btn-sm btn-outline-secondary">
            {% trans "Edit" %}
          </a>
          <a href="{% url 'subjects:delete_lesson' subject.code lesson.pk %}" class="btn btn-sm btn-outline-danger">
            {% trans "Delete" %}
          </a>
        </div>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="mt-3">{% trans "No lessons available." %}</p>
  {% endif %}

  <div class="mt-3">
    <a href="{% url 'subjects:subject_list' %}" class="btn btn-secondary">{% trans "Back to subjects" %}</a>

    {% if request.user.profile.role == 'T' and subject.teacher == request.user %}
      <a href="{% url 'subjects:add_lesson' subject.code %}" class="btn btn-primary ms-2">{% trans "Add lesson" %}</a>
      <a href="{% url 'subjects:edit_marks' subject.code %}" class="btn btn-outline-success ms-2">{% trans "Edit marks" %}</a>
      <a href="{% url 'subjects:mark_list' subject.code %}" class="btn btn-outline-info ms-2">{% trans "View marks" %}</a>
    {% endif %}
  </div>
</div>
{% endblock %}